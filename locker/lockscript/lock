#!@shell@

export GST_PLUGIN_SYSTEM_PATH_1_0=@gstPluginsPath@

image_file=/run/user/$UID/screen_lock.png
resolution=$(@xdpyinfo@/bin/xdpyinfo | grep dimensions | awk '{print $2}')
w=${resolution%%x*}
h=${resolution##*x}
@gstreamer@/bin/gst-launch-1.0 -q \
    videomixer name=mix ! \
    pngenc snapshot=true ! filesink "location=$image_file" \
    \
    ximagesrc use-damage=true show-pointer=true ! \
    videoscale method=3 ! video/x-raw,width=$((w>>4)),height=$((h>>4)) ! \
    videoscale method=3 ! video/x-raw,width=$w,height=$h ! \
    videoconvert ! \
    mix. \
    \
    filesrc location=@out@/share/lockscript/lock.png ! \
    pngdec ! \
    imagefreeze ! \
    videobox border-alpha=0 autocrop=true ! \
    video/x-raw,width=$w,height=$((h/2)) ! \
    mix. \
    ;
@i3lock@/bin/i3lock -e -i "$image_file"
